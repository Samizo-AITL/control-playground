<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Galaxy Flythrough</title>
<style>
html,body{
  margin:0;
  padding:0;
  background:black;
  overflow:hidden;
}
canvas{
  display:block;
}
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

const W = () => canvas.width;
const H = () => canvas.height;

/* ===== galaxy stars ===== */
const GALAXY_STARS = 4000;
const galaxy = [];

for(let i=0;i<GALAXY_STARS;i++){
  const r = Math.pow(Math.random(),0.5);
  const a = r * 6 + Math.random()*0.5;
  galaxy.push({
    r,
    a,
    z: Math.random(),
    hue: 200 + Math.random()*60
  });
}

/* ===== flythrough stars ===== */
const FLY_STARS = 1200;
const stars = [];

function resetStar(s){
  s.x = (Math.random()-0.5)*2;
  s.y = (Math.random()-0.5)*2;
  s.z = Math.random()*1;
}

for(let i=0;i<FLY_STARS;i++){
  const s={};
  resetStar(s);
  stars.push(s);
}

let t = 0;

function draw(){
  ctx.fillStyle="rgba(0,0,0,0.25)";
  ctx.fillRect(0,0,W(),H());

  const cx = W()/2;
  const cy = H()/2;

  // ---- timeline ----
  const zoomIn = Math.min(1, t/8);
  const fly = Math.max(0, Math.min(1, (t-6)/6));
  const zoomOut = Math.max(0, Math.min(1, (t-12)/8));

  const zoom = 1 + zoomIn*4 - zoomOut*3;

  ctx.save();
  ctx.translate(cx,cy);
  ctx.scale(zoom,zoom);

  /* ===== galaxy ===== */
  galaxy.forEach(s=>{
    const angle = s.a + t*0.05;
    const r = s.r * Math.min(W(),H())*0.45;
    const x = Math.cos(angle)*r;
    const y = Math.sin(angle)*r;

    ctx.fillStyle=`hsla(${s.hue},100%,70%,${1-fly})`;
    ctx.fillRect(x,y,1.2,1.2);
  });

  ctx.restore();

  /* ===== star flythrough ===== */
  if(fly>0){
    stars.forEach(s=>{
      s.z -= 0.02 * fly;
      if(s.z<=0.01) resetStar(s);

      const x = cx + s.x/s.z * cx;
      const y = cy + s.y/s.z * cy;
      const r = (1-s.z)*2.2;

      ctx.fillStyle="white";
      ctx.fillRect(x,y,r,r);
    });
  }

  t += 0.016;
  requestAnimationFrame(draw);
}

ctx.fillStyle="black";
ctx.fillRect(0,0,W(),H());
draw();
</script>
</body>
</html>
